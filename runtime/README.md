# XLLR of the *Python3* Plugin

Python3 XLLR plugin calls functions in Python3 modules.
It loads the foreign modules, loads the foreign function stub (created by the MetaFFI compiler) and calls it.
The XLLR plugin is used when **Calling to** *Python3*

Python3 XLLR plugin uses [Python C-API](https://docs.python.org/3/c-api/index.html)

## xllr_plugin_interface

Loads Python3 runtime using `Py_InitializeEx`
```
void load_runtime(
    char** err, // out error string - null if there is none
    uint32_t* err_len // length of error string
)
```

---

Free Python3 runtime using `Py_FinalizeEx`
```
void free_runtime(
    char** err, // out error string - null if there is none
    uint32_t* err_len // length of error string
)
```

---

Imports Python3 module using `PyImport_ImportModuleEx`
```
void load_module(
    const char* module, // module to load
    uint32_t module_len, // module to load length
    char** err, // out error string - null if there is none
    uint32_t* err_len // length of error string
)
```

---

Releases the Python3 module by removing the module from modules dictionary
```
void free_module(
    const char* module, // module to load
    uint32_t module_len, // module to load length
    char** err, // out error string - null if there is none
    uint32_t* err_len // length of error string
)
```

---

Lazy load the module, if not loaded.\
Loads the requested function and calls it.\

The code generated in the host language by the MetaFFI compiler (when compiling "from") is calling a stub function of the foreign function in a module generated by the MetaFFI compiler (when compiling "to").\
The function signature must be of the expected signature:
```
def f(paramsVal: bytes) -> Tuple[bytes,str]
```

*out_params* are not supported and ignored in Python3 plugin.

```
void xcall(
    
    // module foreign function is in. lazy load module if not loaded.
    const char* module_name, uint32_t module_name_len,
    
    // function name to xcall
    const char* func_name, uint32_t func_name_len,
    
    // serialized parameters
    unsigned char* in_params, uint64_t in_params_len,
    
    // out - serialized returned ref parameters
    unsigned char** out_params, uint64_t* out_params_len,
    
    // out - serialized result or error message
    unsigned char** out_ret, uint64_t* out_ret_len,
    
    // out - 0 if not an error, otherwise an error
    // if is_error is non-zero, out_ret is a string
    uint8_t* is_error
)
```

